<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ===== Iconscout CSS ===== -->
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
  <link rel="stylesheet" href="./lib/bootstrap/css/bootstrap.css" />
  <link rel="stylesheet" href="./css/login_register.css" />
  <link rel="stylesheet" href="./lib/bootstrap/js/bootstrap.bundle.js" />
  <script src="./lib/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- ===== CSS ===== -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"
    integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>

  <title>Login & Registration Form</title>
</head>

<body>
  <div class="container">
    <div class="forms">
      <div class="form login">
        <span class="title">Login</span>
        <form action="" method="post" id="form-login">
          <div class="input-field">
            <input id="username" name="name" type="text" placeholder="Enter your username" required />
            <i class="uil uil-user"></i>
          </div>
          <div class="input-field">
            <input id="password" type="password" class="password" name="password" placeholder="Enter your password"
              required />
            <i class="uil uil-lock icon"></i>
            <i class="uil uil-eye-slash showHidePw"></i>
          </div>
          <div class="input-field button">
            <input type="submit" value="Login" />
          </div>
        </form>

        <div class="login-signup">
          <span class="text">Not a member?
            <a href="#" class="text signup-link">Signup Now</a>
          </span>
        </div>

        <div id="err_login" class="error"></div>
      </div>

      <!-- Registration Form -->
      <div class="form signup">
        <span class="title">Registration</span>
        <form action="" method="post" id="form-signup">
          <div class="flex-box">
            <div class="input-field">
              <input id="first_name" type="text" placeholder="First name" required />
              <i class="uil uil-user-square"></i>
            </div>
            <div class="input-field">
              <input id="last_name" type="text" placeholder="Last name" required />
              <i class="uil uil-user-square"></i>
            </div>
          </div>
          <div class="flex-box">
            <div class="input-field">
              <input id="username_rg" type="text" placeholder="Username" required />
              <i class="uil uil-user"></i>
            </div>
            <div class="input-field">
              <input id="phone" type="text" placeholder="Phone" required />
              <i class="uil uil-phone icon"></i>
            </div>
          </div>
          <div class="input-field">
            <input id="password_rg" type="password" class="password" placeholder="Create a password" required />
            <i class="uil uil-lock icon"></i>
          </div>
          <div class="input-field">
            <input id="password_rg_confirm" type="password" class="password" placeholder="Confirm a password"
              required />
            <i class="uil uil-lock icon"></i>
            <i class="uil uil-eye-slash showHidePw"></i>
          </div>
          <div class="input-field button">
            <input type="submit" value="Signup" />
          </div>
        </form>

        <div class="login-signup">
          <span class="text">Already a member?
            <a href="#" class="text login-link">Login Now</a>
          </span>
        </div>
        <div id="err_register" class="error"></div>
      </div>
    </div>
  </div>
  <!-- modal -->
  <div style="top: 10%" class="modal-alert alert alert-success d-none position-absolute" role="alert">
    <!-- <button
        type="button"
        class="close"
        data-dismiss="alert"
        aria-label="Close"
      >
        <span aria-hidden="true">&times;</span>
      </button> -->
    <strong>Bạn đã đăng nhập thành công!</strong>
  </div>
  <script>
    $("#form-login").submit(function (e) {
      e.preventDefault();
      let name = document.getElementById("username").value;
      let password = document.getElementById("password").value;
      console.log(name, password);
      let check = checkLogin();
      let fd = new FormData();
      fd.append("name", name);
      fd.append("password", password);
      console.log(check);
      if (check) {
        $.ajax({
          url: "./api/accounts/login.php",
          type: "post",
          processData: false,
          contentType: false,
          data: fd,
          success: function (data) {
            let error = document.querySelector("#err_login");
            if (data?.id) {
              console.log(data.id);
              error.style.display = "none";
              $(".modal-alert").removeClass("d-none");
              window.setTimeout(function () {
                $(".alert")
                  .fadeTo(500, 0)
                  .slideUp(500, function () {
                    $(this).remove();
                    location.assign("./index.html");
                  });
              }, 1500);
            } else if (data.message == "tai khoan khong ton tai") {
              error.innerHTML = " tai khoan khong ton ta";
              error.style.display = "block";
            } else if (data.message == "khong dung mat khau") {
              error.innerHTML = " khong dung mat khau";
              error.style.display = "block";
            } else {
              error.innerHTML = " dang nhap thanh cong";
              error.style.display = "block";
            }
          },
          error: function (e) {
            console.log(e);
          },
        });
      }
    });
    $("#form-signup").submit(function (e) {
      e.preventDefault();
      let checkValidated = checkRegister();
      console.log(checkValidated);
      let first_name = document.getElementById("first_name").value;
      let last_name = document.getElementById("last_name").value;
      let username = document.getElementById("username_rg").value;
      let phone = document.getElementById("phone").value;
      let password = document.getElementById("password_rg").value;
      let error = document.querySelector("#err_register");
      let fdata = new FormData();
      fdata.append("first_name", first_name);
      fdata.append("last_name", last_name);
      fdata.append("password", password);
      fdata.append("phone", phone);
      fdata.append("name", username);
      if (checkValidated) {
        $.ajax({
          url: "../api/accounts/create.php",
          type: "post",
          processData: false,
          contentType: false,
          data: fdata,
          success: function (data) {
            console.log(data);
            if (data.message == "account Created") {
              error.style.display = "none";
              $(".modal-alert").removeClass("d-none");
              $(".modal-alert strong").text("Bạn đã đăng kí thành công!");
              window.setTimeout(function () {
                $(".alert")
                  .fadeTo(500, 0)
                  .slideUp(500, function () {
                    $(this).remove();
                    location.assign("./index.html");
                  });
              }, 1500);
            } else if (data.message == "tai khoan da ton tai") {
              error.innerHTML = " tai khoan da ton tai";
              error.style.display = "block";
            } else if (data.message == "account Not Created") {
              error.innerHTML = " account Not Created";
              error.style.display = "block";
            }
          },
          error: function (e) {
            console.log(e);
          },
        });
      }
    });
    function checkRegister() {
      let first_name = document.getElementById("first_name");
      let last_name = document.getElementById("last_name");
      let username = document.getElementById("username_rg");
      let phone = document.getElementById("phone");
      let password = document.getElementById("password_rg");
      let passwordConfirm = document.getElementById("password_rg_confirm");
      let error = document.querySelector("#err_register");

      if (first_name.value.length < 4 || first_name.value.length >= 10) {
        error.innerHTML = "Độ dài First Name phải lớn hơn 0 và nhỏ hơn 10!";
        error.style.display = "block";
        first_name.focus();
        return false;
      }
      if (last_name.value.length < 4 || last_name.value.length >= 40) {
        error.innerHTML = "Độ dài Last Name phải lớn hơn 0 và nhỏ hơn 40!";
        error.style.display = "block";
        last_name.focus();
        return false;
      }

      if (username.value.length < 4 || username.value.length >= 10) {
        error.innerHTML = "Độ dài username phải lớn hơn 4 và nhỏ hơn 10!";
        error.style.display = "block";
        username.focus();
        return false;
      }
      let regex = /^\d{10}$/;
      if (!phone.value.match(regex)) {
        error.innerHTML = "SĐT phải là số và phải có độ dài = 10!";
        error.style.display = "block";
        phone.focus();
        return false;
      }
      if (password.value.length < 4) {
        error.innerHTML = "Độ dài password phải lớn hơn 4!";
        error.style.display = "block";
        password.focus();
        return false;
      }
      if (password.value !== passwordConfirm.value) {
        error.innerHTML = "Password không trùng khớp!";
        error.style.display = "block";
        passwordConfirm.focus();
        return false;
      }
      error.style.display = "none";
      return true;
    }
    function checkLogin() {
      var username = document.getElementById("username");
      var password = document.getElementById("password");
      var error = document.querySelector("#err_login");
      if (username.value.length < 4 || username.value.length >= 10) {
        error.innerHTML = "Độ dài username phải lớn hơn 4 và nhỏ hơn 10!";
        error.style.display = "block";
        username.focus();
        return false;
      }
      if (username.value.includes(" ")) {
        error.innerHTML = "Username không được chứa khoảng trắng!";
        error.style.display = "block";
        username.focus();
        return false;
      }
      if (username.value.toLowerCase() != username.value) {
        error.innerHTML = "Username phải là chuỗi kí tự thường!";
        error.style.display = "block";
        username.focus();
        return false;
      }
      if (password.value.length < 4) {
        error.innerHTML = "Độ dài password phải lớn hơn 4!";
        error.style.display = "block";
        password.focus();
        return false;
      }
      error.style.display = "none";
      return true;
    }
  </script>
  <script type="text/javascript" src="./javascript/login_register.js"></script>
</body>

</html>